{"version":3,"sources":["../src/tour.js"],"names":["Tour","config","init","eventHandlers","reset","originalConfiguration","configure","apply","arguments","storage","window","sessionStorage","storageKey","tourName","e","hide","resetStepListeners","steps","currentStepNumber","eventName","forEach","handler","addEventHandler","resetStepDefaults","template","templateContent","checkMinimumRequirements","Error","length","loadOriginalConfiguration","stepDefaults","setStepDefaults","$","extend","element","placement","delay","moveOnClick","moveAfterTime","orphan","direction","parseInt","stepNumber","setItem","code","DOMException","QUOTA_EXCEEDED_ERR","removeItem","getCurrentStepNumber","nextStepNumber","isStepPotentiallyVisible","getStepConfig","previousStepNumber","getNextStepNumber","getPreviousStepNumber","stepConfig","isStepActuallyVisible","position","result","stepId","stepid","target","getStepTarget","is","gotoStep","endTour","_gotoStep","delayed","setTimeout","bind","fn","stepRenderEvent","dispatchEvent","eventTypes","stepRender","defaultPrevented","renderStep","stepRendered","normalizeStepConfig","reflex","moveAfterClick","content","body","attachTo","attachPoint","first","detail","cancelable","tour","document","push","listeners","node","currentStepNode","args","proxy","next","previous","handleKeyDown","targetNode","parents","listener","on","off","currentStepConfig","setCurrentStepNumber","getTemplateContent","find","html","title","isFirstStep","prop","isLastStep","removeClass","addClass","attr","stepsPotentiallyVisible","getPotentiallyVisibleSteps","totalStepsPotentiallyVisible","filter","x","total","then","value","catch","addStepToPage","processStepListeners","clone","animationTarget","stop","data","zIndex","calculateZIndex","css","positionBackdrop","append","top","left","animate","scrollTop","calculateScrollTop","promise","positionStep","revealStep","isOrphan","offset","calculateStepPositionInPage","currentStepPopper","Popper","removeOnDestroy","arrowElement","modifiers","enabled","applyStyle","onLoad","fadeIn","announceStep","focus","bodyRegion","headerRegion","accessibilityShow","tabbableSelector","keyCode","hasBackdrop","activeElement","stepTarget","tabbableNodes","dialogContainer","currentIndex","index","has","each","nextIndex","nextNode","focusRelevant","shiftKey","closest","last","preventDefault","call","startAt","storageStartValue","getItem","storageStartAt","tourStartEvent","tourStart","tourRunning","tourStarted","startTour","tourEndEvent","tourEnd","previousTarget","tourEnded","transition","stepHideEvent","stepHide","destroy","fadeTime","remove","removeAttr","fadeOut","currentStepElement","accessibilityHide","stepHidden","viewportHeight","height","parent","Math","max","min","ceil","stepHeight","viewportWidth","width","stepWidth","recalculatePlacement","flipBehavior","flip","behaviour","arrow","onCreate","recalculateArrowPosition","onUpdate","split","isVertical","indexOf","instance","popper","querySelector","stepElement","arrowHeight","parseFloat","getComputedStyle","arrowOffset","popperHeight","popperOffset","popperBorderWidth","popperBorderRadiusWidth","arrowPos","maxPos","minPos","newArrowPos","arrowWidth","popperWidth","background","widthContent","targetOffsetLeft","targetOffsetRight","documentElement","clientWidth","backdrop","insertAfter","buffer","colorNode","drawertop","outerWidth","outerHeight","backgroundColor","calculateInherittedBackgroundColor","targetRadius","targetPosition","calculatePosition","fader","opacity","targetClone","elem","isNaN","fakeNode","fakeElemColor","color","hideFunction","child","flexitourRole","hidden","Aria","siblings","parentsUntil","showFunction","unhide"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A user tour.\n *\n * @module tool_usertours/tour\n * @copyright  2018 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as Aria from 'core/aria';\nimport Popper from 'core/popper';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport {eventTypes} from './events';\nimport {get_string as getString} from 'core/str';\n\n/**\n * A user tour.\n *\n * @class tool_usertours/tour\n * @property {boolean} tourRunning Whether the tour is currently running.\n */\nconst Tour = class {\n    tourRunning = false;\n\n    /**\n     * @param   {object}    config  The configuration object.\n     */\n    constructor(config) {\n        this.init(config);\n    }\n\n    /**\n     * Initialise the tour.\n     *\n     * @method  init\n     * @param   {Object}    config  The configuration object.\n     * @chainable\n     * @return {Object} this.\n     */\n    init(config) {\n        // Unset all handlers.\n        this.eventHandlers = {};\n\n        // Reset the current tour states.\n        this.reset();\n\n        // Store the initial configuration.\n        this.originalConfiguration = config || {};\n\n        // Apply configuration.\n        this.configure.apply(this, arguments);\n\n        try {\n            this.storage = window.sessionStorage;\n            this.storageKey = 'tourstate_' + this.tourName;\n        } catch (e) {\n            this.storage = false;\n            this.storageKey = '';\n        }\n\n        return this;\n    }\n\n    /**\n     * Reset the current tour state.\n     *\n     * @method  reset\n     * @chainable\n     * @return {Object} this.\n     */\n    reset() {\n        // Hide the current step.\n        this.hide();\n\n        // Unset all handlers.\n        this.eventHandlers = [];\n\n        // Unset all listeners.\n        this.resetStepListeners();\n\n        // Unset the original configuration.\n        this.originalConfiguration = {};\n\n        // Reset the current step number and list of steps.\n        this.steps = [];\n\n        // Reset the current step number.\n        this.currentStepNumber = 0;\n\n        return this;\n    }\n\n    /**\n     * Prepare tour configuration.\n     *\n     * @method  configure\n     * @param {Object} config The configuration object.\n     * @chainable\n     * @return {Object} this.\n     */\n    configure(config) {\n        if (typeof config === 'object') {\n            // Tour name.\n            if (typeof config.tourName !== 'undefined') {\n                this.tourName = config.tourName;\n            }\n\n            // Set up eventHandlers.\n            if (config.eventHandlers) {\n                for (let eventName in config.eventHandlers) {\n                    config.eventHandlers[eventName].forEach(function(handler) {\n                        this.addEventHandler(eventName, handler);\n                    }, this);\n                }\n            }\n\n            // Reset the step configuration.\n            this.resetStepDefaults(true);\n\n            // Configure the steps.\n            if (typeof config.steps === 'object') {\n                this.steps = config.steps;\n            }\n\n            if (typeof config.template !== 'undefined') {\n                this.templateContent = config.template;\n            }\n        }\n\n        // Check that we have enough to start the tour.\n        this.checkMinimumRequirements();\n\n        return this;\n    }\n\n    /**\n     * Check that the configuration meets the minimum requirements.\n     *\n     * @method  checkMinimumRequirements\n     */\n    checkMinimumRequirements() {\n        // Need a tourName.\n        if (!this.tourName) {\n            throw new Error(\"Tour Name required\");\n        }\n\n        // Need a minimum of one step.\n        if (!this.steps || !this.steps.length) {\n            throw new Error(\"Steps must be specified\");\n        }\n    }\n\n    /**\n     * Reset step default configuration.\n     *\n     * @method  resetStepDefaults\n     * @param   {Boolean}   loadOriginalConfiguration   Whether to load the original configuration supplied with the Tour.\n     * @chainable\n     * @return {Object} this.\n     */\n    resetStepDefaults(loadOriginalConfiguration) {\n        if (typeof loadOriginalConfiguration === 'undefined') {\n            loadOriginalConfiguration = true;\n        }\n\n        this.stepDefaults = {};\n        if (!loadOriginalConfiguration || typeof this.originalConfiguration.stepDefaults === 'undefined') {\n            this.setStepDefaults({});\n        } else {\n            this.setStepDefaults(this.originalConfiguration.stepDefaults);\n        }\n\n        return this;\n    }\n\n    /**\n     * Set the step defaults.\n     *\n     * @method  setStepDefaults\n     * @param   {Object}    stepDefaults                The step defaults to apply to all steps\n     * @chainable\n     * @return {Object} this.\n     */\n    setStepDefaults(stepDefaults) {\n        if (!this.stepDefaults) {\n            this.stepDefaults = {};\n        }\n        $.extend(\n            this.stepDefaults,\n            {\n                element:        '',\n                placement:      'top',\n                delay:          0,\n                moveOnClick:    false,\n                moveAfterTime:  0,\n                orphan:         false,\n                direction:      1,\n            },\n            stepDefaults\n        );\n\n        return this;\n    }\n\n    /**\n     * Retrieve the current step number.\n     *\n     * @method  getCurrentStepNumber\n     * @return  {Number}                   The current step number\n     */\n    getCurrentStepNumber() {\n        return parseInt(this.currentStepNumber, 10);\n    }\n\n    /**\n     * Store the current step number.\n     *\n     * @method  setCurrentStepNumber\n     * @param   {Number}   stepNumber      The current step number\n     * @chainable\n     */\n    setCurrentStepNumber(stepNumber) {\n        this.currentStepNumber = stepNumber;\n        if (this.storage) {\n            try {\n                this.storage.setItem(this.storageKey, stepNumber);\n            } catch (e) {\n                if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {\n                    this.storage.removeItem(this.storageKey);\n                }\n            }\n        }\n    }\n\n    /**\n     * Get the next step number after the currently displayed step.\n     *\n     * @method  getNextStepNumber\n     * @param   {Number}   stepNumber      The current step number\n     * @return  {Number}    The next step number to display\n     */\n    getNextStepNumber(stepNumber) {\n        if (typeof stepNumber === 'undefined') {\n            stepNumber = this.getCurrentStepNumber();\n        }\n        let nextStepNumber = stepNumber + 1;\n\n        // Keep checking the remaining steps.\n        while (nextStepNumber <= this.steps.length) {\n            if (this.isStepPotentiallyVisible(this.getStepConfig(nextStepNumber))) {\n                return nextStepNumber;\n            }\n            nextStepNumber++;\n        }\n\n        return null;\n    }\n\n    /**\n     * Get the previous step number before the currently displayed step.\n     *\n     * @method  getPreviousStepNumber\n     * @param   {Number}   stepNumber      The current step number\n     * @return  {Number}    The previous step number to display\n     */\n    getPreviousStepNumber(stepNumber) {\n        if (typeof stepNumber === 'undefined') {\n            stepNumber = this.getCurrentStepNumber();\n        }\n        let previousStepNumber = stepNumber - 1;\n\n        // Keep checking the remaining steps.\n        while (previousStepNumber >= 0) {\n            if (this.isStepPotentiallyVisible(this.getStepConfig(previousStepNumber))) {\n                return previousStepNumber;\n            }\n            previousStepNumber--;\n        }\n\n        return null;\n    }\n\n    /**\n     * Is the step the final step number?\n     *\n     * @method  isLastStep\n     * @param   {Number}   stepNumber  Step number to test\n     * @return  {Boolean}               Whether the step is the final step\n     */\n    isLastStep(stepNumber) {\n        let nextStepNumber = this.getNextStepNumber(stepNumber);\n\n        return nextStepNumber === null;\n    }\n\n    /**\n     * Is the step the first step number?\n     *\n     * @method  isFirstStep\n     * @param   {Number}   stepNumber  Step number to test\n     * @return  {Boolean}               Whether the step is the first step\n     */\n    isFirstStep(stepNumber) {\n        let previousStepNumber = this.getPreviousStepNumber(stepNumber);\n\n        return previousStepNumber === null;\n    }\n\n    /**\n     * Is this step potentially visible?\n     *\n     * @method  isStepPotentiallyVisible\n     * @param   {Object}    stepConfig      The step configuration to normalise\n     * @return  {Boolean}               Whether the step is the potentially visible\n     */\n    isStepPotentiallyVisible(stepConfig) {\n        if (!stepConfig) {\n            // Without step config, there can be no step.\n            return false;\n        }\n\n        if (this.isStepActuallyVisible(stepConfig)) {\n            // If it is actually visible, it is already potentially visible.\n            return true;\n        }\n\n        if (typeof stepConfig.orphan !== 'undefined' && stepConfig.orphan) {\n            // Orphan steps have no target. They are always visible.\n            return true;\n        }\n\n        if (typeof stepConfig.delay !== 'undefined' && stepConfig.delay) {\n            // Only return true if the activated has not been used yet.\n            return true;\n        }\n\n        // Not theoretically, or actually visible.\n        return false;\n    }\n\n    /**\n     * Get potentially visible steps in a tour.\n     *\n     * @method  getPotentiallyVisibleSteps\n     * @return  {array} Step id and position for all potentially visible steps.\n     */\n    getPotentiallyVisibleSteps() {\n        let position = 1,\n            stepNumber = 0,\n            result = [];\n        // Checking the total steps.\n        while (stepNumber <= this.steps.length) {\n            let stepConfig = this.getStepConfig(stepNumber);\n            if (this.isStepPotentiallyVisible(stepConfig)) {\n                result[stepNumber] = {stepId: stepConfig.stepid, position: position};\n                position++;\n            }\n            stepNumber++;\n        }\n\n        return result;\n    }\n\n    /**\n     * Is this step actually visible?\n     *\n     * @method  isStepActuallyVisible\n     * @param   {Object}    stepConfig      The step configuration to normalise\n     * @return  {Boolean}               Whether the step is actually visible\n     */\n    isStepActuallyVisible(stepConfig) {\n        if (!stepConfig) {\n            // Without step config, there can be no step.\n            return false;\n        }\n\n        let target = this.getStepTarget(stepConfig);\n        if (target && target.length && target.is(':visible')) {\n            // Without a target, there can be no step.\n            return !!target.length;\n        }\n\n        return false;\n    }\n\n    /**\n     * Go to the next step in the tour.\n     *\n     * @method  next\n     * @chainable\n     * @return {Object} this.\n     */\n    next() {\n        return this.gotoStep(this.getNextStepNumber());\n    }\n\n    /**\n     * Go to the previous step in the tour.\n     *\n     * @method  previous\n     * @chainable\n     * @return {Object} this.\n     */\n    previous() {\n        return this.gotoStep(this.getPreviousStepNumber(), -1);\n    }\n\n    /**\n     * Go to the specified step in the tour.\n     *\n     * @method  gotoStep\n     * @param   {Number}   stepNumber     The step number to display\n     * @param   {Number}   direction      Next or previous step\n     * @chainable\n     * @return {Object} this.\n     * @fires tool_usertours/stepRender\n     * @fires tool_usertours/stepRendered\n     * @fires tool_usertours/stepHide\n     * @fires tool_usertours/stepHidden\n     */\n    gotoStep(stepNumber, direction) {\n        if (stepNumber < 0) {\n            return this.endTour();\n        }\n\n        let stepConfig = this.getStepConfig(stepNumber);\n        if (stepConfig === null) {\n            return this.endTour();\n        }\n\n        return this._gotoStep(stepConfig, direction);\n    }\n\n    _gotoStep(stepConfig, direction) {\n        if (!stepConfig) {\n            return this.endTour();\n        }\n\n        if (typeof stepConfig.delay !== 'undefined' && stepConfig.delay && !stepConfig.delayed) {\n            stepConfig.delayed = true;\n            window.setTimeout(this._gotoStep.bind(this), stepConfig.delay, stepConfig, direction);\n\n            return this;\n        } else if (!stepConfig.orphan && !this.isStepActuallyVisible(stepConfig)) {\n            let fn = direction == -1 ? 'getPreviousStepNumber' : 'getNextStepNumber';\n            return this.gotoStep(this[fn](stepConfig.stepNumber), direction);\n        }\n\n        this.hide();\n\n        const stepRenderEvent = this.dispatchEvent(eventTypes.stepRender, {stepConfig}, true);\n        if (!stepRenderEvent.defaultPrevented) {\n            this.renderStep(stepConfig);\n            this.dispatchEvent(eventTypes.stepRendered, {stepConfig});\n        }\n\n        return this;\n    }\n\n    /**\n     * Fetch the normalised step configuration for the specified step number.\n     *\n     * @method  getStepConfig\n     * @param   {Number}   stepNumber      The step number to fetch configuration for\n     * @return  {Object}                    The step configuration\n     */\n    getStepConfig(stepNumber) {\n        if (stepNumber === null || stepNumber < 0 || stepNumber >= this.steps.length) {\n            return null;\n        }\n\n        // Normalise the step configuration.\n        let stepConfig = this.normalizeStepConfig(this.steps[stepNumber]);\n\n        // Add the stepNumber to the stepConfig.\n        stepConfig = $.extend(stepConfig, {stepNumber: stepNumber});\n\n        return stepConfig;\n    }\n\n    /**\n     * Normalise the supplied step configuration.\n     *\n     * @method  normalizeStepConfig\n     * @param   {Object}    stepConfig      The step configuration to normalise\n     * @return  {Object}                    The normalised step configuration\n     */\n    normalizeStepConfig(stepConfig) {\n\n        if (typeof stepConfig.reflex !== 'undefined' && typeof stepConfig.moveAfterClick === 'undefined') {\n            stepConfig.moveAfterClick = stepConfig.reflex;\n        }\n\n        if (typeof stepConfig.element !== 'undefined' && typeof stepConfig.target === 'undefined') {\n            stepConfig.target = stepConfig.element;\n        }\n\n        if (typeof stepConfig.content !== 'undefined' && typeof stepConfig.body === 'undefined') {\n            stepConfig.body = stepConfig.content;\n        }\n\n        stepConfig = $.extend({}, this.stepDefaults, stepConfig);\n\n        stepConfig = $.extend({}, {\n            attachTo: stepConfig.target,\n            attachPoint: 'after',\n        }, stepConfig);\n\n        if (stepConfig.attachTo) {\n            stepConfig.attachTo = $(stepConfig.attachTo).first();\n        }\n\n        return stepConfig;\n    }\n\n    /**\n     * Fetch the actual step target from the selector.\n     *\n     * This should not be called until after any delay has completed.\n     *\n     * @method  getStepTarget\n     * @param   {Object}    stepConfig      The step configuration\n     * @return  {$}\n     */\n    getStepTarget(stepConfig) {\n        if (stepConfig.target) {\n            return $(stepConfig.target);\n        }\n\n        return null;\n    }\n\n    /**\n     * Fire any event handlers for the specified event.\n     *\n     * @param {String} eventName The name of the event\n     * @param {Object} [detail={}] Any additional details to pass into the eveent\n     * @param {Boolean} [cancelable=false] Whether preventDefault() can be called\n     * @returns {CustomEvent}\n     */\n    dispatchEvent(\n        eventName,\n        detail = {},\n        cancelable = false\n    ) {\n        return dispatchEvent(eventName, {\n            // Add the tour to the detail.\n            tour: this,\n            ...detail,\n        }, document, {\n            cancelable,\n        });\n    }\n\n    /**\n     * @method addEventHandler\n     * @param  {string}      eventName       The name of the event to listen for\n     * @param  {function}    handler         The event handler to call\n     * @return {Object} this.\n     */\n    addEventHandler(eventName, handler) {\n        if (typeof this.eventHandlers[eventName] === 'undefined') {\n            this.eventHandlers[eventName] = [];\n        }\n\n        this.eventHandlers[eventName].push(handler);\n\n        return this;\n    }\n\n    /**\n     * Process listeners for the step being shown.\n     *\n     * @method  processStepListeners\n     * @param   {object}    stepConfig      The configuration for the step\n     * @chainable\n     * @return {Object} this.\n     */\n    processStepListeners(stepConfig) {\n        this.listeners.push(\n        // Next/Previous buttons.\n        {\n            node: this.currentStepNode,\n            args: ['click', '[data-role=\"next\"]', $.proxy(this.next, this)]\n        }, {\n            node: this.currentStepNode,\n            args: ['click', '[data-role=\"previous\"]', $.proxy(this.previous, this)]\n        },\n\n        // Close and end tour buttons.\n        {\n            node: this.currentStepNode,\n            args: ['click', '[data-role=\"end\"]', $.proxy(this.endTour, this)]\n        },\n\n        // Click backdrop and hide tour.\n        {\n            node: $('[data-flexitour=\"backdrop\"]'),\n            args: ['click', $.proxy(this.hide, this)]\n        },\n\n        // Keypresses.\n        {\n            node: $('body'),\n            args: ['keydown', $.proxy(this.handleKeyDown, this)]\n        });\n\n        if (stepConfig.moveOnClick) {\n            var targetNode = this.getStepTarget(stepConfig);\n            this.listeners.push({\n                node: targetNode,\n                args: ['click', $.proxy(function(e) {\n                    if ($(e.target).parents('[data-flexitour=\"container\"]').length === 0) {\n                        // Ignore clicks when they are in the flexitour.\n                        window.setTimeout($.proxy(this.next, this), 500);\n                    }\n                }, this)]\n            });\n        }\n\n        this.listeners.forEach(function(listener) {\n            listener.node.on.apply(listener.node, listener.args);\n        });\n\n        return this;\n    }\n\n    /**\n     * Reset step listeners.\n     *\n     * @method  resetStepListeners\n     * @chainable\n     * @return {Object} this.\n     */\n    resetStepListeners() {\n        // Stop listening to all external handlers.\n        if (this.listeners) {\n            this.listeners.forEach(function(listener) {\n                listener.node.off.apply(listener.node, listener.args);\n            });\n        }\n        this.listeners = [];\n\n        return this;\n    }\n\n    /**\n     * The standard step renderer.\n     *\n     * @method  renderStep\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    renderStep(stepConfig) {\n        // Store the current step configuration for later.\n        this.currentStepConfig = stepConfig;\n        this.setCurrentStepNumber(stepConfig.stepNumber);\n\n        // Fetch the template and convert it to a $ object.\n        let template = $(this.getTemplateContent());\n\n        // Title.\n        template.find('[data-placeholder=\"title\"]')\n            .html(stepConfig.title);\n\n        // Body.\n        template.find('[data-placeholder=\"body\"]')\n            .html(stepConfig.body);\n\n        // Is this the first step?\n        if (this.isFirstStep(stepConfig.stepNumber)) {\n            template.find('[data-role=\"previous\"]').hide();\n        } else {\n            template.find('[data-role=\"previous\"]').prop('disabled', false);\n        }\n\n        // Is this the final step?\n        if (this.isLastStep(stepConfig.stepNumber)) {\n            template.find('[data-role=\"next\"]').hide();\n            template.find('[data-role=\"end\"]').removeClass(\"btn-secondary\").addClass(\"btn-primary\");\n        } else {\n            template.find('[data-role=\"next\"]').prop('disabled', false);\n        }\n\n        template.find('[data-role=\"previous\"]').attr('role', 'button');\n        template.find('[data-role=\"next\"]').attr('role', 'button');\n        template.find('[data-role=\"end\"]').attr('role', 'button');\n\n        if (template.find('[data-placeholder=\"step\"]').length) {\n            const stepsPotentiallyVisible = this.getPotentiallyVisibleSteps(),\n                totalStepsPotentiallyVisible = stepsPotentiallyVisible.filter(x => x !== 'empty').length,\n                position = stepsPotentiallyVisible[stepConfig.stepNumber].position;\n            if (totalStepsPotentiallyVisible == 1) {\n                template.find('[data-placeholder=\"step\"]').hide();\n            } else {\n                // Add 'position of total potentially visible steps' to template.\n                getString('numberofsteps', 'tool_usertours',\n                    {position: position, total: totalStepsPotentiallyVisible}).then(value => {\n                    template.find('[data-placeholder=\"step\"]').html(value);\n                    return;\n                }).catch();\n            }\n        }\n\n        // Replace the template with the updated version.\n        stepConfig.template = template;\n\n        // Add to the page.\n        this.addStepToPage(stepConfig);\n\n        // Process step listeners after adding to the page.\n        // This uses the currentNode.\n        this.processStepListeners(stepConfig);\n\n        return this;\n    }\n\n    /**\n     * Getter for the template content.\n     *\n     * @method  getTemplateContent\n     * @return  {$}\n     */\n    getTemplateContent() {\n        return $(this.templateContent).clone();\n    }\n\n    /**\n     * Helper to add a step to the page.\n     *\n     * @method  addStepToPage\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    addStepToPage(stepConfig) {\n        // Create the stepNode from the template data.\n        let currentStepNode = $('<span data-flexitour=\"container\"></span>')\n            .html(stepConfig.template)\n            .hide();\n\n        // The scroll animation occurs on the body or html.\n        let animationTarget = $('body, html')\n            .stop(true, true);\n\n        if (this.isStepActuallyVisible(stepConfig)) {\n            let targetNode = this.getStepTarget(stepConfig);\n\n            if (targetNode.parents('[data-usertour=\"scroller\"]').length) {\n                animationTarget = targetNode.parents('[data-usertour=\"scroller\"]');\n            }\n\n            targetNode.data('flexitour', 'target');\n\n            let zIndex = this.calculateZIndex(targetNode);\n            if (zIndex) {\n                stepConfig.zIndex = zIndex + 1;\n            }\n\n            if (stepConfig.zIndex) {\n                currentStepNode.css('zIndex', stepConfig.zIndex + 1);\n            }\n\n            // Add the backdrop.\n            this.positionBackdrop(stepConfig);\n\n            $(document.body).append(currentStepNode);\n            this.currentStepNode = currentStepNode;\n\n            // Ensure that the step node is positioned.\n            // Some situations mean that the value is not properly calculated without this step.\n            this.currentStepNode.css({\n                top: 0,\n                left: 0,\n            });\n\n            animationTarget\n                .animate({\n                    scrollTop: this.calculateScrollTop(stepConfig),\n                }).promise().then(function() {\n                        this.positionStep(stepConfig);\n                        this.revealStep(stepConfig);\n                        return;\n                    }.bind(this))\n                    .catch(function() {\n                        // Silently fail.\n                    });\n\n        } else if (stepConfig.orphan) {\n            stepConfig.isOrphan = true;\n\n            // This will be appended to the body instead.\n            stepConfig.attachTo = $('body').first();\n            stepConfig.attachPoint = 'append';\n\n            // Add the backdrop.\n            this.positionBackdrop(stepConfig);\n\n            // This is an orphaned step.\n            currentStepNode.addClass('orphan');\n\n            // It lives in the body.\n            $(document.body).append(currentStepNode);\n            this.currentStepNode = currentStepNode;\n\n            this.currentStepNode.offset(this.calculateStepPositionInPage());\n            this.currentStepNode.css('position', 'fixed');\n\n            this.currentStepPopper = new Popper(\n                $('body'),\n                this.currentStepNode[0], {\n                    removeOnDestroy: true,\n                    placement: stepConfig.placement + '-start',\n                    arrowElement: '[data-role=\"arrow\"]',\n                    // Empty the modifiers. We've already placed the step and don't want it moved.\n                    modifiers: {\n                        hide: {\n                            enabled: false,\n                        },\n                        applyStyle: {\n                            onLoad: null,\n                            enabled: false,\n                        },\n                    }\n                }\n            );\n\n            this.revealStep(stepConfig);\n        }\n\n        return this;\n    }\n\n    /**\n     * Make the given step visible.\n     *\n     * @method revealStep\n     * @param {Object} stepConfig The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    revealStep(stepConfig) {\n        // Fade the step in.\n        this.currentStepNode.fadeIn('', $.proxy(function() {\n                // Announce via ARIA.\n                this.announceStep(stepConfig);\n\n                // Focus on the current step Node.\n                this.currentStepNode.focus();\n                window.setTimeout($.proxy(function() {\n                    // After a brief delay, focus again.\n                    // There seems to be an issue with Jaws where it only reads the dialogue title initially.\n                    // This second focus helps it to read the full dialogue.\n                    if (this.currentStepNode) {\n                        this.currentStepNode.focus();\n                    }\n                }, this), 100);\n\n            }, this));\n\n        return this;\n    }\n\n    /**\n     * Helper to announce the step on the page.\n     *\n     * @method  announceStep\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    announceStep(stepConfig) {\n        // Setup the step Dialogue as per:\n        // * https://www.w3.org/TR/wai-aria-practices/#dialog_nonmodal\n        // * https://www.w3.org/TR/wai-aria-practices/#dialog_modal\n\n        // Generate an ID for the current step node.\n        let stepId = 'tour-step-' + this.tourName + '-' + stepConfig.stepNumber;\n        this.currentStepNode.attr('id', stepId);\n\n        let bodyRegion = this.currentStepNode.find('[data-placeholder=\"body\"]').first();\n        bodyRegion.attr('id', stepId + '-body');\n        bodyRegion.attr('role', 'document');\n\n        let headerRegion = this.currentStepNode.find('[data-placeholder=\"title\"]').first();\n        headerRegion.attr('id', stepId + '-title');\n        headerRegion.attr('aria-labelledby', stepId + '-body');\n\n        // Generally, a modal dialog has a role of dialog.\n        this.currentStepNode.attr('role', 'dialog');\n        this.currentStepNode.attr('tabindex', 0);\n        this.currentStepNode.attr('aria-labelledby', stepId + '-title');\n        this.currentStepNode.attr('aria-describedby', stepId + '-body');\n\n        // Configure ARIA attributes on the target.\n        let target = this.getStepTarget(stepConfig);\n        if (target) {\n            if (!target.attr('tabindex')) {\n                target.attr('tabindex', 0);\n            }\n\n            target\n                .data('original-describedby', target.attr('aria-describedby'))\n                .attr('aria-describedby', stepId + '-body')\n                ;\n        }\n\n        this.accessibilityShow(stepConfig);\n\n        return this;\n    }\n\n    /**\n     * Handle key down events.\n     *\n     * @method  handleKeyDown\n     * @param   {EventFacade} e\n     */\n    handleKeyDown(e) {\n        let tabbableSelector = 'a[href], link[href], [draggable=true], [contenteditable=true], ';\n        tabbableSelector += ':input:enabled, [tabindex], button:enabled';\n        switch (e.keyCode) {\n            case 27:\n                this.endTour();\n                break;\n\n            // 9 == Tab - trap focus for items with a backdrop.\n            case 9:\n                // Tab must be handled on key up only in this instance.\n                (function() {\n                    if (!this.currentStepConfig.hasBackdrop) {\n                        // Trapping tab focus is only handled for those steps with a backdrop.\n                        return;\n                    }\n\n                    // Find all tabbable locations.\n                    let activeElement = $(document.activeElement);\n                    let stepTarget = this.getStepTarget(this.currentStepConfig);\n                    let tabbableNodes = $(tabbableSelector);\n                    let dialogContainer = $('span[data-flexitour=\"container\"]');\n                    let currentIndex;\n                    // Filter out element which is not belong to target section or dialogue.\n                    if (stepTarget) {\n                        tabbableNodes = tabbableNodes.filter(function(index, element) {\n                            return stepTarget !== null\n                                && (stepTarget.has(element).length\n                                    || dialogContainer.has(element).length\n                                    || stepTarget.is(element)\n                                    || dialogContainer.is(element));\n                        });\n                    }\n\n                    // Find index of focusing element.\n                    tabbableNodes.each(function(index, element) {\n                        if (activeElement.is(element)) {\n                            currentIndex = index;\n                            return false;\n                        }\n                        // Keep looping.\n                        return true;\n                    });\n\n                    let nextIndex;\n                    let nextNode;\n                    let focusRelevant;\n                    if (currentIndex != void 0) {\n                        let direction = 1;\n                        if (e.shiftKey) {\n                            direction = -1;\n                        }\n                        nextIndex = currentIndex;\n                        do {\n                            nextIndex += direction;\n                            nextNode = $(tabbableNodes[nextIndex]);\n                        } while (nextNode.length && nextNode.is(':disabled') || nextNode.is(':hidden'));\n                        if (nextNode.length) {\n                            // A new f\n                            focusRelevant = nextNode.closest(stepTarget).length;\n                            focusRelevant = focusRelevant || nextNode.closest(this.currentStepNode).length;\n                        } else {\n                            // Unable to find the target somehow.\n                            focusRelevant = false;\n                        }\n                    }\n\n                    if (focusRelevant) {\n                        nextNode.focus();\n                    } else {\n                        if (e.shiftKey) {\n                            // Focus on the last tabbable node in the step.\n                            this.currentStepNode.find(tabbableSelector).last().focus();\n                        } else {\n                            if (this.currentStepConfig.isOrphan) {\n                                // Focus on the step - there is no target.\n                                this.currentStepNode.focus();\n                            } else {\n                                // Focus on the step target.\n                                stepTarget.focus();\n                            }\n                        }\n                    }\n                    e.preventDefault();\n                }).call(this);\n                break;\n        }\n    }\n\n    /**\n     * Start the current tour.\n     *\n     * @method  startTour\n     * @param   {Number} startAt Which step number to start at. If not specified, starts at the last point.\n     * @chainable\n     * @return {Object} this.\n     * @fires tool_usertours/tourStart\n     * @fires tool_usertours/tourStarted\n     */\n    startTour(startAt) {\n        if (this.storage && typeof startAt === 'undefined') {\n            let storageStartValue = this.storage.getItem(this.storageKey);\n            if (storageStartValue) {\n                let storageStartAt = parseInt(storageStartValue, 10);\n                if (storageStartAt <= this.steps.length) {\n                    startAt = storageStartAt;\n                }\n            }\n        }\n\n        if (typeof startAt === 'undefined') {\n            startAt = this.getCurrentStepNumber();\n        }\n\n        const tourStartEvent = this.dispatchEvent(eventTypes.tourStart, {startAt}, true);\n        if (!tourStartEvent.defaultPrevented) {\n            this.gotoStep(startAt);\n            this.tourRunning = true;\n            this.dispatchEvent(eventTypes.tourStarted, {startAt});\n        }\n\n        return this;\n    }\n\n    /**\n     * Restart the tour from the beginning, resetting the completionlag.\n     *\n     * @method  restartTour\n     * @chainable\n     * @return {Object} this.\n     */\n    restartTour() {\n        return this.startTour(0);\n    }\n\n    /**\n     * End the current tour.\n     *\n     * @method  endTour\n     * @chainable\n     * @return {Object} this.\n     * @fires tool_usertours/tourEnd\n     * @fires tool_usertours/tourEnded\n     */\n    endTour() {\n        const tourEndEvent = this.dispatchEvent(eventTypes.tourEnd, {}, true);\n        if (tourEndEvent.defaultPrevented) {\n            return this;\n        }\n\n        if (this.currentStepConfig) {\n            let previousTarget = this.getStepTarget(this.currentStepConfig);\n            if (previousTarget) {\n                if (!previousTarget.attr('tabindex')) {\n                    previousTarget.attr('tabindex', '-1');\n                }\n                previousTarget.focus();\n            }\n        }\n\n        this.hide(true);\n\n        this.tourRunning = false;\n        this.dispatchEvent(eventTypes.tourEnded);\n\n        return this;\n    }\n\n    /**\n     * Hide any currently visible steps.\n     *\n     * @method hide\n     * @param {Bool} transition Animate the visibility change\n     * @chainable\n     * @return {Object} this.\n     * @fires tool_usertours/stepHide\n     * @fires tool_usertours/stepHidden\n     */\n    hide(transition) {\n        const stepHideEvent = this.dispatchEvent(eventTypes.stepHide, {}, true);\n        if (stepHideEvent.defaultPrevented) {\n            return this;\n        }\n\n        if (this.currentStepNode && this.currentStepNode.length) {\n            this.currentStepNode.hide();\n            if (this.currentStepPopper) {\n                this.currentStepPopper.destroy();\n            }\n        }\n\n        // Restore original target configuration.\n        if (this.currentStepConfig) {\n            let target = this.getStepTarget(this.currentStepConfig);\n            if (target) {\n                if (target.data('original-labelledby')) {\n                    target.attr('aria-labelledby', target.data('original-labelledby'));\n                }\n\n                if (target.data('original-describedby')) {\n                    target.attr('aria-describedby', target.data('original-describedby'));\n                }\n\n                if (target.data('original-tabindex')) {\n                    target.attr('tabindex', target.data('tabindex'));\n                }\n            }\n\n            // Clear the step configuration.\n            this.currentStepConfig = null;\n        }\n\n        let fadeTime = 0;\n        if (transition) {\n            fadeTime = 400;\n        }\n\n        // Remove the backdrop features.\n        $('[data-flexitour=\"step-background\"]').remove();\n        $('[data-flexitour=\"step-backdrop\"]').removeAttr('data-flexitour');\n        $('[data-flexitour=\"backdrop\"]').fadeOut(fadeTime, function() {\n            $(this).remove();\n        });\n\n        // Remove aria-describedby and tabindex attributes.\n        if (this.currentStepNode && this.currentStepNode.length) {\n            let stepId = this.currentStepNode.attr('id');\n            if (stepId) {\n                let currentStepElement = '[aria-describedby=\"' + stepId + '-body\"]';\n                $(currentStepElement).removeAttr('tabindex');\n                $(currentStepElement).removeAttr('aria-describedby');\n            }\n        }\n\n        // Reset the listeners.\n        this.resetStepListeners();\n\n        this.accessibilityHide();\n\n        this.dispatchEvent(eventTypes.stepHidden);\n\n        this.currentStepNode = null;\n        this.currentStepPopper = null;\n        return this;\n    }\n\n    /**\n     * Show the current steps.\n     *\n     * @method show\n     * @chainable\n     * @return {Object} this.\n     */\n    show() {\n        // Show the current step.\n        let startAt = this.getCurrentStepNumber();\n\n        return this.gotoStep(startAt);\n    }\n\n    /**\n     * Return the current step node.\n     *\n     * @method  getStepContainer\n     * @return  {jQuery}\n     */\n    getStepContainer() {\n        return $(this.currentStepNode);\n    }\n\n    /**\n     * Calculate scrollTop.\n     *\n     * @method  calculateScrollTop\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @return  {Number}\n     */\n    calculateScrollTop(stepConfig) {\n        let viewportHeight = $(window).height();\n        let targetNode = this.getStepTarget(stepConfig);\n\n        parent = $(window);\n        if (targetNode.parents('[data-usertour=\"scroller\"]').length) {\n            parent = targetNode.parents('[data-usertour=\"scroller\"]');\n        }\n        let scrollTop = parent.scrollTop();\n\n        if (stepConfig.placement === 'top') {\n            // If the placement is top, center scroll at the top of the target.\n            scrollTop = targetNode.offset().top - (viewportHeight / 2);\n        } else if (stepConfig.placement === 'bottom') {\n            // If the placement is bottom, center scroll at the bottom of the target.\n            scrollTop = targetNode.offset().top + targetNode.height() + scrollTop - (viewportHeight / 2);\n        } else if (targetNode.height() <= (viewportHeight * 0.8)) {\n            // If the placement is left/right, and the target fits in the viewport, centre screen on the target\n            scrollTop = targetNode.offset().top - ((viewportHeight - targetNode.height()) / 2);\n        } else {\n            // If the placement is left/right, and the target is bigger than the viewport, set scrollTop to target.top + buffer\n            // and change step attachmentTarget to top+.\n            scrollTop = targetNode.offset().top - (viewportHeight * 0.2);\n        }\n\n        // Never scroll over the top.\n        scrollTop = Math.max(0, scrollTop);\n\n        // Never scroll beyond the bottom.\n        scrollTop = Math.min($(document).height() - viewportHeight, scrollTop);\n\n        return Math.ceil(scrollTop);\n    }\n\n    /**\n     * Calculate dialogue position for page middle.\n     *\n     * @method  calculateScrollTop\n     * @return  {Number}\n     */\n    calculateStepPositionInPage() {\n        let viewportHeight = $(window).height();\n        let stepHeight = this.currentStepNode.height();\n\n        let viewportWidth = $(window).width();\n        let stepWidth = this.currentStepNode.width();\n\n        return {\n            top: Math.ceil((viewportHeight - stepHeight) / 2),\n            left: Math.ceil((viewportWidth - stepWidth) / 2)\n        };\n    }\n\n    /**\n     * Position the step on the page.\n     *\n     * @method  positionStep\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    positionStep(stepConfig) {\n        let content = this.currentStepNode;\n        if (!content || !content.length) {\n            // Unable to find the step node.\n            return this;\n        }\n\n        stepConfig.placement = this.recalculatePlacement(stepConfig);\n        let flipBehavior;\n        switch (stepConfig.placement) {\n            case 'left':\n                flipBehavior = ['left', 'right', 'top', 'bottom'];\n                break;\n            case 'right':\n                flipBehavior = ['right', 'left', 'top', 'bottom'];\n                break;\n            case 'top':\n                flipBehavior = ['top', 'bottom', 'right', 'left'];\n                break;\n            case 'bottom':\n                flipBehavior = ['bottom', 'top', 'right', 'left'];\n                break;\n            default:\n                flipBehavior = 'flip';\n                break;\n        }\n\n        let target = this.getStepTarget(stepConfig);\n        var config = {\n            placement: stepConfig.placement + '-start',\n            removeOnDestroy: true,\n            modifiers: {\n                flip: {\n                    behaviour: flipBehavior,\n                },\n                arrow: {\n                    element: '[data-role=\"arrow\"]',\n                },\n            },\n            onCreate: function(data) {\n                recalculateArrowPosition(data);\n            },\n            onUpdate: function(data) {\n                recalculateArrowPosition(data);\n            },\n        };\n\n        let recalculateArrowPosition = function(data) {\n            let placement = data.placement.split('-')[0];\n            const isVertical = ['left', 'right'].indexOf(placement) !== -1;\n            const arrowElement = data.instance.popper.querySelector('[data-role=\"arrow\"]');\n            const stepElement = $(data.instance.popper.querySelector('[data-role=\"flexitour-step\"]'));\n            if (isVertical) {\n                let arrowHeight = parseFloat(window.getComputedStyle(arrowElement).height);\n                let arrowOffset = parseFloat(window.getComputedStyle(arrowElement).top);\n                let popperHeight = parseFloat(window.getComputedStyle(data.instance.popper).height);\n                let popperOffset = parseFloat(window.getComputedStyle(data.instance.popper).top);\n                let popperBorderWidth = parseFloat(stepElement.css('borderTopWidth'));\n                let popperBorderRadiusWidth = parseFloat(stepElement.css('borderTopLeftRadius')) * 2;\n                let arrowPos = arrowOffset + (arrowHeight / 2);\n                let maxPos = popperHeight + popperOffset - popperBorderWidth - popperBorderRadiusWidth;\n                let minPos = popperOffset + popperBorderWidth + popperBorderRadiusWidth;\n                if (arrowPos >= maxPos || arrowPos <= minPos) {\n                    let newArrowPos = 0;\n                    if (arrowPos > (popperHeight / 2)) {\n                        newArrowPos = maxPos - arrowHeight;\n                    } else {\n                        newArrowPos = minPos + arrowHeight;\n                    }\n                    $(arrowElement).css('top', newArrowPos);\n                }\n            } else {\n                let arrowWidth = parseFloat(window.getComputedStyle(arrowElement).width);\n                let arrowOffset = parseFloat(window.getComputedStyle(arrowElement).left);\n                let popperWidth = parseFloat(window.getComputedStyle(data.instance.popper).width);\n                let popperOffset = parseFloat(window.getComputedStyle(data.instance.popper).left);\n                let popperBorderWidth = parseFloat(stepElement.css('borderTopWidth'));\n                let popperBorderRadiusWidth = parseFloat(stepElement.css('borderTopLeftRadius')) * 2;\n                let arrowPos = arrowOffset + (arrowWidth / 2);\n                let maxPos = popperWidth + popperOffset - popperBorderWidth - popperBorderRadiusWidth;\n                let minPos = popperOffset + popperBorderWidth + popperBorderRadiusWidth;\n                if (arrowPos >= maxPos || arrowPos <= minPos) {\n                    let newArrowPos = 0;\n                    if (arrowPos > (popperWidth / 2)) {\n                        newArrowPos = maxPos - arrowWidth;\n                    } else {\n                        newArrowPos = minPos + arrowWidth;\n                    }\n                    $(arrowElement).css('left', newArrowPos);\n                }\n            }\n        };\n\n        let background = $('[data-flexitour=\"step-background\"]');\n        if (background.length) {\n            target = background;\n        }\n        this.currentStepPopper = new Popper(target, content[0], config);\n\n        return this;\n    }\n\n    /**\n     * For left/right placement, checks that there is room for the step at current window size.\n     *\n     * If there is not enough room, changes placement to 'top'.\n     *\n     * @method  recalculatePlacement\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @return  {String}                    The placement after recalculate\n     */\n    recalculatePlacement(stepConfig) {\n        const buffer = 10;\n        const arrowWidth = 16;\n        let target = this.getStepTarget(stepConfig);\n        let widthContent = this.currentStepNode.width() + arrowWidth;\n        let targetOffsetLeft = target.offset().left - buffer;\n        let targetOffsetRight = target.offset().left + target.width() + buffer;\n        let placement = stepConfig.placement;\n\n        if (['left', 'right'].indexOf(placement) !== -1) {\n            if ((targetOffsetLeft < (widthContent + buffer)) &&\n                ((targetOffsetRight + widthContent + buffer) > document.documentElement.clientWidth)) {\n                placement = 'top';\n            }\n        }\n        return placement;\n    }\n\n    /**\n     * Add the backdrop.\n     *\n     * @method  positionBackdrop\n     * @param   {Object}    stepConfig      The step configuration of the step\n     * @chainable\n     * @return {Object} this.\n     */\n    positionBackdrop(stepConfig) {\n        if (stepConfig.backdrop) {\n            this.currentStepConfig.hasBackdrop = true;\n            let backdrop = $('<div data-flexitour=\"backdrop\"></div>');\n\n            if (stepConfig.zIndex) {\n                if (stepConfig.attachPoint === 'append') {\n                    stepConfig.attachTo.append(backdrop);\n                } else {\n                    backdrop.insertAfter(stepConfig.attachTo);\n                }\n            } else {\n                $('body').append(backdrop);\n            }\n\n            if (this.isStepActuallyVisible(stepConfig)) {\n                // The step has a visible target.\n                // Punch a hole through the backdrop.\n                let background = $('[data-flexitour=\"step-background\"]');\n                if (!background.length) {\n                    background = $('<div data-flexitour=\"step-background\"></div>');\n                }\n\n                let targetNode = this.getStepTarget(stepConfig);\n\n                let buffer = 10;\n\n                let colorNode = targetNode;\n                if (buffer) {\n                    colorNode = $('body');\n                }\n\n                let drawertop = 0;\n                if (targetNode.parents('[data-usertour=\"scroller\"]').length) {\n                    drawertop = targetNode.parents('[data-usertour=\"scroller\"]').scrollTop();                background.css({\n                       position: 'fixed'\n                    });\n                }\n\n                background.css({\n                    width: targetNode.outerWidth() + buffer + buffer,\n                    height: targetNode.outerHeight() + buffer + buffer,\n                    left: targetNode.offset().left - buffer,\n                    top: targetNode.offset().top + drawertop - buffer,\n                    backgroundColor: this.calculateInherittedBackgroundColor(colorNode),\n                });\n\n                if (targetNode.offset().left < buffer) {\n                    background.css({\n                        width: targetNode.outerWidth() + targetNode.offset().left + buffer,\n                        left: targetNode.offset().left,\n                    });\n                }\n\n                if ((targetNode.offset().top  + drawertop) < buffer) {\n                    background.css({\n                        height: targetNode.outerHeight() + targetNode.offset().top + buffer,\n                        top: targetNode.offset().top,\n                    });\n                }\n\n                let targetRadius = targetNode.css('borderRadius');\n                if (targetRadius && targetRadius !== $('body').css('borderRadius')) {\n                    background.css('borderRadius', targetRadius);\n                }\n\n                let targetPosition = this.calculatePosition(targetNode);\n                if (targetPosition === 'fixed') {\n                    background.css('top', 0);\n                } else if (targetPosition === 'absolute') {\n                    background.css('position', 'fixed');\n                }\n\n                let fader = background.clone();\n                fader.css({\n                    backgroundColor: backdrop.css('backgroundColor'),\n                    opacity: backdrop.css('opacity'),\n                });\n                fader.attr('data-flexitour', 'step-background-fader');\n\n                if (targetNode.parents('[data-region=\"fixed-drawer\"]').length) {\n                    let targetClone = targetNode.clone();\n                    background.append(targetClone);\n                }\n\n                if (stepConfig.zIndex) {\n                    if (stepConfig.attachPoint === 'append') {\n                        stepConfig.attachTo.append(background);\n                    } else {\n                        fader.insertAfter(stepConfig.attachTo);\n                        background.insertAfter(stepConfig.attachTo);\n                    }\n                } else {\n                    $('body').append(fader);\n                    $('body').append(background);\n                }\n\n                // Add the backdrop data to the actual target.\n                // This is the part which actually does the work.\n                targetNode.attr('data-flexitour', 'step-backdrop');\n\n                if (stepConfig.zIndex) {\n                    backdrop.css('zIndex', stepConfig.zIndex);\n                    background.css('zIndex', stepConfig.zIndex + 1);\n                    targetNode.css('zIndex', stepConfig.zIndex + 2);\n                }\n\n                fader.fadeOut('2000', function() {\n                    $(this).remove();\n                });\n            }\n        }\n        return this;\n    }\n\n    /**\n     * Calculate the inheritted z-index.\n     *\n     * @method  calculateZIndex\n     * @param   {jQuery}    elem                        The element to calculate z-index for\n     * @return  {Number}                                Calculated z-index\n     */\n    calculateZIndex(elem) {\n        elem = $(elem);\n        while (elem.length && elem[0] !== document) {\n            // Ignore z-index if position is set to a value where z-index is ignored by the browser\n            // This makes behavior of this function consistent across browsers\n            // WebKit always returns auto if the element is positioned.\n            let position = elem.css(\"position\");\n            if (position === \"absolute\" || position === \"relative\" || position === \"fixed\") {\n                // IE returns 0 when zIndex is not specified\n                // other browsers return a string\n                // we ignore the case of nested elements with an explicit value of 0\n                // <div style=\"z-index: -10;\"><div style=\"z-index: 0;\"></div></div>\n                let value = parseInt(elem.css(\"zIndex\"), 10);\n                if (!isNaN(value) && value !== 0) {\n                    return value;\n                }\n            }\n            elem = elem.parent();\n        }\n\n        return 0;\n    }\n\n    /**\n     * Calculate the inheritted background colour.\n     *\n     * @method  calculateInherittedBackgroundColor\n     * @param   {jQuery}    elem                        The element to calculate colour for\n     * @return  {String}                                Calculated background colour\n     */\n    calculateInherittedBackgroundColor(elem) {\n        // Use a fake node to compare each element against.\n        let fakeNode = $('<div>').hide();\n        $('body').append(fakeNode);\n        let fakeElemColor = fakeNode.css('backgroundColor');\n        fakeNode.remove();\n\n        elem = $(elem);\n        while (elem.length && elem[0] !== document) {\n            let color = elem.css('backgroundColor');\n            if (color !== fakeElemColor) {\n                return color;\n            }\n            elem = elem.parent();\n        }\n\n        return null;\n    }\n\n    /**\n     * Calculate the inheritted position.\n     *\n     * @method  calculatePosition\n     * @param   {jQuery}    elem                        The element to calculate position for\n     * @return  {String}                                Calculated position\n     */\n    calculatePosition(elem) {\n        elem = $(elem);\n        while (elem.length && elem[0] !== document) {\n            let position = elem.css('position');\n            if (position !== 'static') {\n                return position;\n            }\n            elem = elem.parent();\n        }\n\n        return null;\n    }\n\n    /**\n     * Perform accessibility changes for step shown.\n     *\n     * This will add aria-hidden=\"true\" to all siblings and parent siblings.\n     *\n     * @method  accessibilityShow\n     */\n    accessibilityShow() {\n        let stateHolder = 'data-has-hidden';\n        let attrName = 'aria-hidden';\n        let hideFunction = function(child) {\n            let flexitourRole = child.data('flexitour');\n            if (flexitourRole) {\n                switch (flexitourRole) {\n                    case 'container':\n                    case 'target':\n                        return;\n                }\n            }\n\n            let hidden = child.attr(attrName);\n            if (!hidden) {\n                child.attr(stateHolder, true);\n                Aria.hide(child);\n            }\n        };\n\n        this.currentStepNode.siblings().each(function(index, node) {\n            hideFunction($(node));\n        });\n        this.currentStepNode.parentsUntil('body').siblings().each(function(index, node) {\n            hideFunction($(node));\n        });\n    }\n\n    /**\n     * Perform accessibility changes for step hidden.\n     *\n     * This will remove any newly added aria-hidden=\"true\".\n     *\n     * @method  accessibilityHide\n     */\n    accessibilityHide() {\n        let stateHolder = 'data-has-hidden';\n        let showFunction = function(child) {\n            let hidden = child.attr(stateHolder);\n            if (typeof hidden !== 'undefined') {\n                child.removeAttr(stateHolder);\n                Aria.unhide(child);\n            }\n        };\n\n        $('[' + stateHolder + ']').each(function(index, node) {\n            showFunction($(node));\n        });\n    }\n};\n\nexport default Tour;\n"],"file":"tour.min.js"}