define ("tool_dataprivacy/requestactions",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates","tool_dataprivacy/data_request_modal","tool_dataprivacy/events","tool_dataprivacy/selectedcourses"],function(a,b,c,d,e,f,g,h,i,j){var r={APPROVE_REQUEST:"[data-action=\"approve\"]",DENY_REQUEST:"[data-action=\"deny\"]",VIEW_REQUEST:"[data-action=\"view\"]",MARK_COMPLETE:"[data-action=\"complete\"]",CHANGE_BULK_ACTION:"[id=\"bulk-action\"]",CONFIRM_BULK_ACTION:"[id=\"confirm-bulk-action\"]",SELECT_ALL:"[data-action=\"selectall\"]",APPROVE_REQUEST_SELECT_COURSE:"[data-action=\"approve-selected-courses\"]"},s={APPROVE:1,DENY:2},t={SELECT_REQUEST:".selectrequests"},u=function(){this.registerEvents()};u.prototype.registerEvents=function(){a(r.VIEW_REQUEST).click(function(d){d.preventDefault();var l=a(this).data("requestid"),n=a(this).data("contextid"),o=b.call([{methodname:"tool_dataprivacy_get_data_request",args:{requestid:l}}]);a.when(o[0]).then(function(a){if(a.result){return a.result}c.addNotification({message:a.warnings[0].message,type:"error"});return!1}).then(function(a){var b=g.render("tool_dataprivacy/request_details",a),c={approvedeny:a.approvedeny,canmarkcomplete:a.canmarkcomplete,allowfiltering:a.allowfiltering};return e.create({title:a.typename,body:b,type:h.TYPE,large:!0,templateContext:c})}).then(function(a){a.getRoot().on(i.approve,function(){p(i.approve,k(l))});a.getRoot().on(i.deny,function(){p(i.deny,m(l))});a.getRoot().on(i.complete,function(){q("tool_dataprivacy_mark_complete",{requestid:l})});a.getRoot().on(f.hidden,function(){a.destroy()});a.getRoot().on(i.approveSelectCourses,function(){new j(n,l)});a.show()}).catch(c.exception)});a(r.APPROVE_REQUEST_SELECT_COURSE).click(function(b){b.preventDefault();var c=a(this).data("requestid"),d=a(this).data("contextid");new j(d,c)});a(r.APPROVE_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");p(i.approve,k(c))});a(r.DENY_REQUEST).click(function(b){b.preventDefault();var c=a(this).data("requestid");p(i.deny,m(c))});a(r.MARK_COMPLETE).click(function(b){b.preventDefault();var c=a(this).data("requestid");p(i.complete,o(c))});a(r.CONFIRM_BULK_ACTION).click(function(){var b=[],e="",f={},g=[{key:"selectbulkaction",component:"tool_dataprivacy"},{key:"selectdatarequests",component:"tool_dataprivacy"},{key:"ok"}],h=parseInt(a("#bulk-action").val());if(h!=s.APPROVE&&h!=s.DENY){d.get_strings(g).done(function(a){c.alert("",a[0],a[2])}).fail(c.exception);return}a(".selectrequests:checked").each(function(){b.push(a(this).val())});if(1>b.length){d.get_strings(g).done(function(a){c.alert("",a[1],a[2])}).fail(c.exception);return}switch(h){case s.APPROVE:e=i.bulkApprove;f=l(b);break;case s.DENY:e=i.bulkDeny;f=n(b);}p(e,f)});a(r.SELECT_ALL).change(function(b){b.preventDefault();var c=a(this).is(":checked");a(t.SELECT_REQUEST).prop("checked",c)})};function k(a){return{wsfunction:"tool_dataprivacy_approve_data_request",wsparams:{requestid:a}}}function l(a){return{wsfunction:"tool_dataprivacy_bulk_approve_data_requests",wsparams:{requestids:a}}}function m(a){return{wsfunction:"tool_dataprivacy_deny_data_request",wsparams:{requestid:a}}}function n(a){return{wsfunction:"tool_dataprivacy_bulk_deny_data_requests",wsparams:{requestids:a}}}function o(a){return{wsfunction:"tool_dataprivacy_mark_complete",wsparams:{requestid:a}}}function p(a,b){var g=[];switch(a){case i.approve:g=[{key:"approverequest",component:"tool_dataprivacy"},{key:"confirmapproval",component:"tool_dataprivacy"}];break;case i.bulkApprove:g=[{key:"bulkapproverequests",component:"tool_dataprivacy"},{key:"confirmbulkapproval",component:"tool_dataprivacy"}];break;case i.deny:g=[{key:"denyrequest",component:"tool_dataprivacy"},{key:"confirmdenial",component:"tool_dataprivacy"}];break;case i.bulkDeny:g=[{key:"bulkdenyrequests",component:"tool_dataprivacy"},{key:"confirmbulkdenial",component:"tool_dataprivacy"}];break;case i.complete:g=[{key:"markcomplete",component:"tool_dataprivacy"},{key:"confirmcompletion",component:"tool_dataprivacy"}];break;}var h="";d.get_strings(g).then(function(a){h=a[0];var b=a[1];return e.create({title:h,body:b,type:e.types.SAVE_CANCEL})}).then(function(a){a.setSaveButtonText(h);a.getRoot().on(f.save,function(){q(b.wsfunction,b.wsparams)});a.getRoot().on(f.hidden,function(){a.destroy()});a.show()}).catch(c.exception)}function q(a,d){b.call([{methodname:a,args:d}])[0].done(function(a){if(a.result){window.location.reload()}else{c.addNotification({message:a.warnings[0].message,type:"error"})}}).fail(c.exception)}return u});
//# sourceMappingURL=requestactions.min.js.map
