define("mod_quiz/quiz_toolboxes",["exports","core/ajax","mod_quiz/quiz_utils","core/notification","core/pending"],(function(_exports,_ajax,_quiz_utils,_notification,_pending){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init_resource_toolbox=function(courseid,quizid,ajaxurl){console.table(courseid,quizid,ajaxurl);new ResourceToolBox(courseid,quizid,ajaxurl)},_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending);const CSS_EDITINSTRUCTIONS="editinstructions",CSS_EDITINGMAXMARK="editor_displayed",CSS_TITLEEDITOR="titleeditor",SELECTOR={ACTIONAREA:".actions",ACTIONLINKTEXT:".actionlinktext",ACTIVITYACTION:"a.cm-edit-action[data-action], a.editing_maxmark, a.editing_section, input.shuffle_questions",ACTIVITYFORM:"span.instancemaxmarkcontainer form",ACTIVITYINSTANCE:"."+"activityinstance",SECTIONINSTANCE:".sectioninstance",ACTIVITYLI:"li.activity, li.section",ACTIVITYMAXMARK:"input[name=maxmark]",COMMANDSPAN:".commands",CONFIGTOOLBOX:".config-toolbox",CONTENTAFTERLINK:"div.contentafterlink",CONTENTWITHOUTLINK:"div.contentwithoutlink",DELETESECTIONICON:"a.editing_delete .icon",EDITMAXMARK:"a.editing_maxmark",EDITSECTION:"a.editing_section",EDITSECTIONICON:"a.editing_section .icon",EDITSHUFFLEQUESTIONSACTION:"input.cm-edit-action[data-action]",EDITSHUFFLEAREA:".instanceshufflequestions .shuffle-progress",HIDE:"a.editing_hide",HIGHLIGHT:"a.editing_highlight",INSTANCENAME:"span.instancename",INSTANCEMAXMARK:"span.instancemaxmark",INSTANCESECTION:"span.instancesection",INSTANCESECTIONAREA:"div.section-heading",MAXMARKCONTAINER:".instancemaxmarkcontainer",MODINDENTDIV:".mod-indent",MODINDENTOUTER:".mod-indent-outer",NUMQUESTIONS:".numberofquestions",PAGECONTENT:"div#page-content",PAGELI:"li.page",SECTIONLI:"li.section",SECTIONUL:"ul.section",SECTIONFORM:".instancesectioncontainer form",SECTIONINPUT:"input[name=section]",SELECTMULTIPLEBUTTON:"#selectmultiplecommand",SELECTMULTIPLECANCELBUTTON:"#selectmultiplecancelcommand",SELECTMULTIPLECHECKBOX:".select-multiple-checkbox",SELECTMULTIPLEDELETEBUTTON:"#selectmultipledeletecommand",SELECTALL:"#questionselectall",SHOW:"a."+"editing_show",SLOTLI:"li.slot",SUMMARKS:".mod_quiz_summarks"},BODY=document.body;class ResourceToolBox extends class{constructor(config,courseId,quizId){_defineProperty(this,"config",{}),_defineProperty(this,"quizId",0),_defineProperty(this,"courseId",0),this.config=config,this.courseId=courseId,this.quizId=quizId}sendRequest(data,statusSpinner,methodName,optionalConfig){const parameters={methodname:methodName,args:data};if(optionalConfig)for(let varName in optionalConfig)config[varName]=optionalConfig[varName];return statusSpinner&&statusSpinner.classList.remove("d-none"),(0,_ajax.call)([parameters])[0]}}{constructor(courseId,quizId,ajaxURL){const config=JSON.parse(document.querySelector(SELECTOR.CONFIGTOOLBOX).dataset.config);super(config,courseId,quizId),_defineProperty(this,"courseId",0),_defineProperty(this,"quizId",0),_defineProperty(this,"ajaxURL",null),_defineProperty(this,"config",{}),_defineProperty(this,"editMaxMarkEvents",[]),this.courseId=courseId,this.quizId=quizId,this.ajaxURL=ajaxURL,this.config=config,BODY.addEventListener("click",(event=>{(event.target.closest(SELECTOR.ACTIVITYACTION)||event.target.closest(SELECTOR.DEPENDENCY_LINK))&&this.handleDataAction(event)}))}handleDataAction(ev){let node=ev.target;this.isATag(node)||(node=node.closest(SELECTOR.ACTIVITYACTION));const action=node.dataset.action,activity=node.closest(SELECTOR.ACTIVITYLI);if(this.isATag(node)&&action&&activity)switch(action){case"editmaxmark":this.editMaxMark(ev,node,activity);break;case"delete":this.deleteWithConfirmation(ev,node,activity,action);break;case"addpagebreak":case"removepagebreak":this.updatePageBreak(ev,node,activity,action);break;case"adddependency":case"removedependency":this.updateDependency(ev,node,activity,action)}}isATag(node){return"a"===node.tagName.toLowerCase()}editMaxMark(ev,button,activity){const instanceMaxmark=activity.querySelector(SELECTOR.INSTANCEMAXMARK),instance=activity.querySelector(SELECTOR.ACTIVITYINSTANCE),anchor=instanceMaxmark,oldMaxMark=instanceMaxmark.firstChild.nodeValue,data={id:_quiz_utils.slot.getId(activity),quizid:this.quizId};let maxMarkText=oldMaxMark;ev.preventDefault();new _pending.default("get-max-mark");this.sendRequest(data,null,"mod_quiz_get_max_mark").then((response=>{M.core.actionmenu&&M.core.actionmenu.instance&&M.core.actionmenu.instance.hideMenu(ev),response.instancemaxmark&&(maxMarkText=response.instancemaxmark);const editForm=this.createElement("form",{action:"#"}),editInstructions=this.createElement("span",{id:"id_editinstructions",class:CSS_EDITINSTRUCTIONS});editInstructions.innerHTML=M.util.get_string("edittitleinstructions","moodle");const editor=this.createElement("input",{type:"text",name:"maxmark",class:CSS_TITLEEDITOR,value:maxMarkText,autocomplete:"off","aria-describedby":"id_editinstructions",maxLength:12,size:parseInt(this.config.questiondecimalpoints,10)+2});editForm.appendChild(editor),editForm.dataset.anchor=anchor.outerHTML,instance.parentNode.insertBefore(editInstructions,instance),activity.querySelector(SELECTOR.MAXMARKCONTAINER).replaceChild(editForm,anchor),activity.classList.add(CSS_EDITINGMAXMARK),editor.focus(),editor.select(),editor.addEventListener("blur",(event=>this.handleMaxMarkEditorBlur.call(this,event,activity,!1))),editor.addEventListener("keydown",(event=>this.handleMaxMarkEditorType.call(this,event,activity,!0))),editForm.addEventListener("submit",(event=>this.handleMaxMarkFormSubmit.call(this,event,activity,oldMaxMark))),this.editMaxMarkEvents=[{type:"blur",handler:this.handleMaxMarkEditorBlur,element:editor},{type:"keydown",handler:this.handleMaxMarkEditorType,element:editor},{type:"submit",handler:this.handleMaxMarkFormSubmit,element:editForm}]})).catch(_notification.default.exception)}handleMaxMarkEditorBlur(event,activity,preventDefault){return this.editMaxMarkCancel(event,activity,preventDefault)}handleMaxMarkEditorType(event,activity,preventDefault){"Escape"!==event.key&&27!==event.keyCode||this.editMaxMarkCancel(event,activity,preventDefault)}handleMaxMarkFormSubmit(event,activity,oldMaxMark){return event.preventDefault(),this.editMaxMarkSubmit(event,activity,oldMaxMark)}deleteWithConfirmation(){}updatePageBreak(){}updateDependency(){}createElement(tag,attributes){const element=document.createElement(tag);for(let key in attributes)element.setAttribute(key,attributes[key]);return element}editMaxMarkCancel(ev,activity,preventDefault){preventDefault&&ev.preventDefault(),this.editMaxMarkClear(activity)}editMaxMarkClear(activity){console.log(this.editMaxMarkEvents),this.editMaxMarkEvents.forEach((event=>{event.element.removeEventListener(event.type,event.handler)}));const editForm=activity.querySelector(SELECTOR.ACTIVITYFORM),instructions=activity.querySelector("#id_editinstructions");if(editForm&&(editForm.parentNode.append(editForm.dataset.anchor),editForm.remove()),instructions&&instructions.parentNode.removeChild(instructions),activity.classList.remove(CSS_EDITINGMAXMARK),setTimeout((function(){activity.querySelector(SELECTOR.EDITMAXMARK).focus()}),100),!document.querySelector("input[name=maxmark]")){const input=this.createElement("input",{type:"text",name:"maxmark",class:"d-none"});document.querySelector("body").appendChild(input)}}editMaxMarkSubmit(){}}}));

//# sourceMappingURL=quiz_toolboxes.min.js.map