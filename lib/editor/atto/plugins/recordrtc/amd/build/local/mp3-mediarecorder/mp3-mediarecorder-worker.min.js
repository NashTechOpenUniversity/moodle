function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define ("atto_recordrtc/local/mp3-mediarecorder/mp3-mediarecorder-worker",["exports"],b):(a="undefined"!=typeof globalThis?globalThis:a||self,b(a.mp3EncoderWorker={}))})(this,function(a){'use strict';function b(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})}a.initMp3MediaEncoder=function initMp3MediaEncoder(a){var d=a.vmsgWasmUrl,e=134217728,f=65536,g=self,h=new WebAssembly.Memory({initial:e/f,maximum:e/f}),i=5242880,j={env:{memory:h,sbrk:function sbrk(a){var b=i;i+=a;return b},exit:function exit(){return g.postMessage({type:"ERROR",error:"internal"})},pow:Math.pow,powf:Math.pow,exp:Math.exp,sqrtf:Math.sqrt,cos:Math.cos,log:Math.log,sin:Math.sin}},k=function(a,b){if(!WebAssembly.instantiateStreaming){return c(a,b)}return WebAssembly.instantiateStreaming(fetch(a),b).catch(function(){return c(a,b)})}(d,j).then(function(a){return a.instance.exports}),l=!1,m,n;function c(a,b){return fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){return WebAssembly.instantiate(a,b)})}var o=function(a){return b(void 0,void 0,void 0,regeneratorRuntime.mark(function b(){var c,d;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:b.next=2;return k;case 2:c=b.sent;l=!0;m=c.vmsg_init(a.sampleRate);if(!(!m||!c)){b.next=7;break}throw new Error("init_failed");case 7:d=new Uint32Array(h.buffer,m,1)[0];n=new Float32Array(h.buffer,d);case 9:case"end":return b.stop();}}},b)}))},p=function(){return b(void 0,void 0,void 0,regeneratorRuntime.mark(function a(){var b,c,d,e,f;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return k;case 2:b=a.sent;l=!1;if(!(0>b.vmsg_flush(m))){a.next=6;break}throw new Error("flush_failed");case 6:c=new Uint32Array(h.buffer,m+4,1)[0];d=new Uint32Array(h.buffer,m+8,1)[0];e=new Uint8Array(h.buffer,c,d);f=new Blob([e],{type:"audio/mpeg"});b.vmsg_free(m);return a.abrupt("return",f);case 12:case"end":return a.stop();}}},a)}))},q=function(a){return b(void 0,void 0,void 0,regeneratorRuntime.mark(function b(){var c,d;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:if(l){b.next=2;break}return b.abrupt("return");case 2:n.set(a);b.next=5;return k;case 5:c=b.sent;d=c.vmsg_encode(m,a.length);if(!(0>d)){b.next=9;break}throw new Error("encoding_failed");case 9:case"end":return b.stop();}}},b)}))};g.addEventListener("message",function(a){return b(void 0,void 0,void 0,regeneratorRuntime.mark(function b(){var c,d;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:c=a.data;b.prev=1;b.t0=c.type;b.next="START_RECORDING"===b.t0?5:"DATA_AVAILABLE"===b.t0?9:"STOP_RECORDING"===b.t0?12:17;break;case 5:b.next=7;return o(c.config);case 7:g.postMessage({type:"WORKER_RECORDING"});return b.abrupt("break",17);case 9:b.next=11;return q(c.data);case 11:return b.abrupt("break",17);case 12:b.next=14;return p();case 14:d=b.sent;g.postMessage({type:"BLOB_READY",blob:d});return b.abrupt("break",17);case 17:b.next=22;break;case 19:b.prev=19;b.t1=b["catch"](1);g.postMessage({type:"ERROR",error:b.t1.message});case 22:case"end":return b.stop();}}},b,null,[[1,19]])}))})};Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=mp3-mediarecorder-worker.min.js.map
